{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <!-- Left Column: Book Details and Review Form -->
        <div class="col-12 col-lg-5">
            <h2 class="book-title">{{ book.title }}</h2>
            <p>Author: {{ book.author }}</p>
            <p>Published: 
                {% if book.published_date %}
                    {{ book.published_date.strftime('%d %B, %Y') }}
                {% else %}
                    Unknown
                {% endif %}
            </p>
            <img id="book_cover" class="card-img-top" 
                 src="{{ book.cover_image_url }}" 
                 alt="Book cover of {{ book.title }}" />
            <p>Categories: 
                {% for book_category in book.categories %}
                    {{ book_category.category.category_name }}{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
            <p>Summary: {{  book.summary  }}</p>
            {% if current_user.is_authenticated %}
                <div class="btn-group">
                    <a href="{{ url_for('update_book_description', book_id=book.book_id) }}" class="btn btn-secondary">Update Description</a>
                    <form action="{{ url_for('add_to_reading_list', book_id=book.book_id) }}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-primary">Add to Reading List</button>
                    </form>
                </div>
            {% endif %}
            
            {% if current_user.is_authenticated %}
                <h3>Leave a Review</h3>
                <form method="POST" action="{{ url_for('book_detail', book_id=book.book_id) }}">
                    {{ form.hidden_tag() }}
                    <div class="star-rating">
                        {% for i in range(1, 6) %}
                            <span class="star" data-value="{{ i }}">&#9733;</span>
                        {% endfor %}
                    </div>
                    {{ form.rating(id='rating') }}
                    <br>
                    {{ form.review_text.label }}<br>
                    {{ form.review_text(class_='form-control', rows=5) }}<br>
                    {{ form.submit(class_='btn btn-primary') }}
                </form>
            {% else %}
                <p><a href="{{ url_for('login') }}">Log in</a> to leave a review.</p>
            {% endif %}
        </div>
        <!-- Right Column: Reviews -->
        <div class="col-12 col-lg-3">
            <h3>Reviews</h3>
            <ul>
                {% for review in book.reviews %}
                <li>
                    <!-- Display stars for the rating -->
                    {% for i in range(review.rating) %}
                        &#9733; <!-- star emoji -->
                    {% endfor %}
                    {% for i in range(5 - review.rating) %}
                        &#9734; <!-- empty star emoji -->
                    {% endfor %}<br>
                    {{ review.review_text }} <br> {{ review.user.username }} 
                    <span>({{ review.created_at.strftime('%d/%m/%Y') }})</span>
                    {% if not loop.last %}
                        <hr style="border: 1px solid #4c4c4c;">
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{% endblock %}